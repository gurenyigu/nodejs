# `Nodejs`
## Node.js 是一个怎样的东西
* `Nodejs`不是一种独立的脚本语言，区别于`PHP、Python、Perl、 Ruby`这样的是语言亦是平台。
* 也不是一个JavaScript框架，不同于`CakePHP 、Django、Rails`。
* 更不是浏览器端的库，不能与`jQuery、 ExtJS`相提并论。
* `Node.js`是一个让`JavaScript`运行在服务端的开发平台，它让`JavaScript`成为脚本语言世界的一等公民。

* ####### Node 是一个服务器端 JavaScript 解释器，用于方便地搭建响应速度快、易于扩展的网络应用。Node.js 使用事件驱动， 非阻塞I/O 模型而得以轻量和高效，非常适合在分布式设备上运行数据密集型的实时应用。
---
## Nodejs 能做到什么
* `Nodejs`是一个让`JavaScript`运行在浏览器之外的平台。它实现了例如文件系统、模块、包、操作系统API、网络通讯等`Core JavaScript`没有或者不完善的功能。
* 历史上将`JavaScript`一直到浏览器之外的计划不止一个，但是`Node.js`是最出色的一个。随着`Node.js`的成功，各种浏览器外的`JavaScript`实现逐步兴起，因此产生了`CommonJS`规范。
* `CommonJS`定制这希望众多服务端`JavaScript`实现遵循`CommonJS`规范，以便相互兼容合代码复用。`Nodejs`的部分遵循了`CommonJS`规范，但是由于迭代速度差异，两者也会有不一致的地方。
---
## V8 引擎
* `Nodejs`的`JavaScript`引擎是  V8，来自`Google`的`Chrome`项目。V8一个快速的`JavaScript`引擎，历经了数次引擎革命，他的`JIT`(Just-in-time Compilation,即时编译)执行速度已经快到了接近本地代码执行速度。

* `Nodejs`的成功与V8引擎十分不开的。`Nodejs`不运行在浏览器中，所以也就不存在浏览器兼容问题。可以放心的使用`JavaScript`的所有特性。
* ###### V8 `JavaScript` 引擎是 `Google` 用于其 `Chrome` 浏览器的底层 `JavaScript` 引擎。很少有人考虑 `JavaScript` 在客户机上实际做了些什么？实际上，`JavaScript` 引擎负责解释并执行代码。
* ###### `Google` 使用 V8 创建了一个用 C++ 编写的超快解释器，该解释器拥有另一个独特特征；您可以下载该引擎并将其嵌入任何 应用程序。V8 `JavaScript` 引擎并不仅限于在一个浏览器中运行。因此，`Nodejs` 实际上会使用 `Google` 编写的 V8 `JavaScript` 引擎，并将其重建为可在服务器上使用。
---
[`Nodejs 历史`](http://www.infoq.com/cn/articles/node-js-and-io-js/)
---
# `Nodejs`的应用
* 正如`Javascript`为客户端而生，`Nodejs`位网络而生。`Nodejs`能做到的远不止开发一个网站那么简单，使用`Nodejs`，可以轻松的开发：
    1. 具有复杂逻辑的网站
    2. 基于社交网络的大规模服务器
    3. TCP/UDP 套接字应用程序
    4. 命令行工具
    5. 交互式终端程序
    6. 带有图形用户界面的本地应用程序
    7. 单元测试工具
    8. 客户端`JavaScript`编辑器
---
## `Nodejs`优点：
  1. `Nodejs`采用事件驱动、异步编程，为网络服务而设计。`JavaScript`的匿名函数和闭包特性合适事件驱动、异步编程。
  2. `Nodejs`非阻塞模式的I/O处理给`Nodejs`带来在相对低系统资源耗用下的高性能与出众的负载能力，非常适合作依赖其他I/O资源的中间层服务。
  3. `Nodejs`轻量高效，可以认为是数据密集型分布式部署环境下的实时应用系统的完美解决方案。非常适合在响应客户端之前，您预计可能有很高的流量，但所需的服务器端逻辑和处理不一定很多。
  
## `Nodejs`缺点
  1. 可靠性低
  1. 单进程，单线程，只支持单核CPU，不能充分的利用多核CPU服务器。一旦这个进程崩溃掉，那么整个WEB服务器就崩溃了。
  
### 解决`Nodejs`支持多进程的方式：
  1. 开启多个进程，每个进程绑定不用的端口，用反向代理服务器`如：Nginx`做负载均衡，这样我们可以借助强大的`Nginx`做一些过滤检查之类的操作，同时能够实现比较好的均衡策略。但是弊端是我们在服务中引入了中间层。
  1. 多进程绑定在同一个端口监听。在`Nodejs`中，提供了进程发送“文件句柄“功能。
  1. 一个进程负责监听、接收连接，然后把收到的连接平均发送到子进程中去处理。
---
## 异步式I/O与事件驱动
  `Nodejs`最大的特点就是采用异步式I/O与事件驱动的结构设计。对于高并发的解决方案，传统的架构是多线程模型，也就是每个业务逻辑提供一个系统进程，通过系统线程切换来弥补同步式I/O调用时的时间开销。
  `Nodejs`使用的是单线程模型，对于所有I/O都采用异步式的请求方式，避免了频繁的上下文切换。
  `Nodejs`在执行的过程中会维护一个时间对列，程序在执行时进入事件循环等待下一个事件到来，每个异步式I/O请求完成后会被推送到事件队列，等待程序进程进行处理。
* ###### Node 公开宣称的目标是 “旨在提供一种简单的构建可伸缩网络程序的方法”。
* ###### 我们来看一个简单的例子，在 Java™ 和 PHP 这类语言中，每个连接都会生成一个新线程，每个新线程可能需要 2 MB 的配套内存。在一个拥有 8 GB RAM 的系统上，理论上最大的并发连接数量是 4,000 个用户。随着您的客户群的增长，如果希望您的 Web 应用程序支持更多用户，那么，您必须添加更多服务器。所以在传统的后台开发中，整个 Web 应用程序架构（包括流量、处理器速度和内存速度）中的瓶颈是：服务器能够处理的并发连接的最大数量。这个不同的架构承载的并发数量是不一致的。
* ###### 而Node的出现就是为了解决这个问题：更改连接到服务器的方式。在Node 声称它不允许使用锁，它不会直接阻塞 I/O 调用。Node在每个连接发射一个在 Node 引擎的进程中运行的事件，而不是为每个连接生成一个新的 OS 线程（并为其分配一些配套内存）。
---
## 什么是事件驱动编程
* 区别于Java、PHP等面向对象编程语言，Node使用的是事件驱动编程思想。
* 事件驱动编程，为需要处理的事件编写相应的事件处理程序。代码在事件发生时执行。
* 要对需要处理的事件编写相应的事件处理程序。要理解事件驱动和程序，就需要对非事件驱动的程序进行比较。
* 实际上，现代的程序大多是事件驱动的。比如多线程的程序，肯定是事件驱动的。早期则存在许多非事件驱动的程序，这样的程序在需要等待某个条件触发时，会不断的检查这个条件，直到条件满足，这是很浪费CPU时间的。而事件驱动程序则有机会释放CPU从而进入睡眠（注意是有机会，当然也可以自行决定不释放CPU），当事件触发时，被操作程序唤醒，这样就能更加有效的使用CPU。

## 事件驱动模型
###### 只要包含三个对象：
* 事件源：      产生时间的地方(HTML元素)
* 事件：        鼠标操作/键盘操作等...
* 事件对象：    当某个事件发生时，会产生一个时间对象，该事件对象会封装好该事件信息，传递给事件的处理程序
* 事件处理程序： 响应事件的代码
一个简单的事例：监听鼠标点击事件，并能够显示鼠标点击坐标位置。
```html
<html>
  <head>
  </head>
  <body onmousedown = "test(event)">
  <script>
    function test(e){
      window.alert("x = " + e.clientX + "y = " + e.clientY);
    }
  </script>
  </body>
</html>
```
---
